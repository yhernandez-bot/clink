import fetch from 'node-fetch';

// Obtiene las promos de Cuponatic México
export async function getCuponaticPromos(limit = 5) {
  try {
    const url = `https://www.cuponatic.com.mx/ofertas`;
    const res = await fetch(url);
    const html = await res.text();

    // Buscamos títulos, links y precios en el HTML (simplificado)
    const promos = [];
    const regex = /<a[^>]+href="([^"]+)"[^>]*>(.*?)<\/a>[\s\S]*?(\$[0-9,.]+)/g;

    let match;
    while ((match = regex.exec(html)) !== null && promos.length < limit) {
      const link = "https://www.cuponatic.com.mx" + match[1];
      const title = match[2]
        .replace(/<[^>]+>/g, "") // quitar etiquetas HTML
        .trim();
      const price = match[3];

      promos.push({
        title,
        price,
        url: link
      });
    }

    return promos;
  } catch (err) {
    console.error("[Cuponatic] Error:", err);
    return [];
  }
}